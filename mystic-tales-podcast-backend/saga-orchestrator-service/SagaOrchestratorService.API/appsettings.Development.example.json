{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AppSettings": {
    "APP_PORT": 8081,
    "APP_BASE_URL": "http://localhost:8081",
    "HEALTH_CHECK_ENDPOINT": "/health",
    "IMAGE_SRC": "local", // awsS3 or local
    "DEFAULT_AUTHENTICATION": {
      "Scheme": "Jwt_PublicPrivateKeyAuth"
    },
    "DEFAULT_AUTHORIZATION": {
      "Policy": "BasicAccess"
    },
    "TIME_ZONE": "Asia/Ho_Chi_Minh"
  },
  "FilePaths": {
    "ACCOUNt_IMAGE_PATH": "images_test/accounts",
    "FACILITY_IMAGE_PATH": "images_test/facilities",
    "MAJOR_IMAGE_PATH": "images_test/majors",
    "ITEM_IMAGE_PATH": "images_test/items",
    "SERVICE_IMAGE_PATH": "images_test/services"
  },
  "ConnectionStrings": {
    // "SQLSERVER_DefaultConnectionString": "Server=HAOHA\\SQLEXPRESS;Database=SurveyTalkDB_test_v2;Trusted_Connection=True;TrustServerCertificate=True;",
    "SQLSERVER_DefaultConnectionString": "Server=localhost,1434;Database=MTP_SagaOrchestratorDb_dev;User Id=sa;Password=Banana100;TrustServerCertificate=True;",
    // "SQLSERVER_DefaultConnectionString": "Server=tcp:sql-server-southeast-asia-0.database.windows.net,1433;Initial Catalog=SurveyTalkDB_test_v2;Persist Security Info=False;User ID=admin_0;Password=Banana100;MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;",

    "ConnectionWithLogin": "Server=HAOHA\\SQLEXPRESS;Database=SagaOrchestratorService_DB;User Id=sa;Password=1234563123312;Trusted_Connection=True;TrustServerCertificate=True;"
  },
  "Bcrypt": {
    "SALT_ROUNDS": 10
  },
  "Jwt": {
    "SecretKey": "wxWVhGckp4uR0yiVYJ4oD3IuVmbKyI6kN0RGmRvEOTsCOEj3nIEujRlPBUUh6No3",
    "Issuer": "localhost",
    "Exp": 100000000,
    "Audience": "localhost",
    "AccessTokenExpiration": 30,
    "RefreshTokenExpiration": 60,
    "OpenSSL_PrivateKey_Path": "AppConfigurations\\Jwt\\keys\\private_key.pem",
    "OpenSSL_PublicKey_Path": "AppConfigurations\\Jwt\\keys\\public_key.pem"
  },
  "Infrastructure": {
    "Consul": {
      "Service": {
        "Host": "http://localhost:8501", // Địa chỉ Consul
        "Id": "saga-orchestrator-service-dev-001", // Id của service khi đăng ký với Consul
        "ServiceName": "saga-orchestrator-service", // Tên service sẽ được lưu trong Consul
        "ServiceScheme": "http",
        "Tags": [
          "saga-orchestrator-service",
          "microservice",
          "api"
        ]
      },
      "DistributedLock": {
        // chú thích: T_cycle (thời gian chu kì của job), T_exec (thời gian thực thi job ước tính)
        // TTL = MAX(T_exec × 2 + Buffer, T_cycle × 1.5) , Buffer là thời gian đệm (ví dụ 15s)
        // RenewalInterval = TTL / 3
        // WaitTimeout = MIN(T_exec, 500ms) , 500ms là giới hạn tối đa 500ms (đảm bảo không chờ quá lâu trường hợp lock đã bị acquire bởi instance khác rồi)
        // RetryDelay = MAX(T_network × 2, 500ms) , 500ms là giới hạn tối thiểu 500ms để tránh retry spam
        "LockKeyPrefix": "locks/user-service/",
        "DefaultLockShortTTLSeconds": 120,
        "DefaultLockLongTTLSeconds": 300,
        "DefaultLockShortRenewalIntervalSeconds": 40,
        "DefaultLockLongRenewalIntervalSeconds": 100,
        "DefaultLockWaitTimeoutSeconds": 0.5, // thời gian chờ để có thể acquire lock (try acquire lock nhiều lần trong khoảng thời gian này)
        "DefaultLockRetryDelaySeconds": 0.16 // thời gian chờ giữa các lần try (acquire lock)
      },
      "HealthCheck": {
        "Enabled": true, // Bật kiểm tra sức khỏe,
        "Name": "user-service-health-check", // Tên kiểm tra sức khỏe
        "Notes": "Health check for User Service", // Ghi chú cho kiểm tra sức khỏe
        "BaseUrl": "http://host.docker.internal:8081", // Đường dẫn kiểm tra sức khỏe của service (host.docker.internal:8020 là địa chỉ của ip máy host bên ngoài Docker(window), localhost:8020 là địa chỉ của container nội Docker) 
        "Timeout": 10, // Thời gian timeout cho kiểm tra sức khỏe
        "Interval": 30, // Khoảng thời gian giữa các lần kiểm tra sức khỏe (tăng lên 30 giây)
        "DeregisterCriticalServiceAfter": 300 // Thời gian sau đó sẽ hủy đăng ký service nếu nó không khỏe (5 phút)
      }
    },
    "Redis": {
      "Default": {
        "ConnectionString": "localhost:6380",
        "SharedKeyName": "MTP:Shared",
        "InstanceKeyName": "MTP:UserService",
        "DefaultDatabase": 0,
        "ConnectTimeout": 5000,
        "SyncTimeout": 5000,
        "AbortOnConnectFail": false,
        "ConnectRetry": 3,
        "UseSsl": false,
        "Password": "1234563123312"
      },
      "Cache": {
        "KeyPrefix": "cache",
        "ExpirySeconds": 3600,
        "SlidingExpirationSeconds": 1800
      },
      "Session": {
        "KeyPrefix": "session",
        "ExpirySeconds": 1800
      },
      "RateLimit": {
        "KeyPrefix": "ratelimit",
        "WindowSeconds": 60,
        "MaxRequests": 100
      },
      "MessageQueue": {
        "KeyPrefix": "queue",
        "ExpirySeconds": 86400
      },
      "Lock": {
        "KeyPrefix": "lock",
        "ExpirySeconds": 300
      },
      "Analytics": {
        "KeyPrefix": "analytics",
        "RetentionDays": 30
      },
      "Config": {
        "KeyPrefix": "redis",
        "RefreshIntervalSeconds": 300
      },
      "JobQueue": {
        "KeyPrefix": "jobs",
        "MaxRetries": 3,
        "RetryDelaySeconds": 300
      }
    },
    "Kafka": {
      "Cluster": {
        "BootstrapServers": [
          "localhost:9092",
          "localhost:9093",
          "localhost:9094"
        ],
        "ClientId": "saga-orchestrator",
        "SecurityProtocol": "Plaintext",
        "SaslMechanism": "Plain",
        "SaslUsername": "",
        "SaslPassword": "",
        "ConnectionRetries": 3,
        "ConnectionTimeoutMs": 30000,
        "RequestTimeoutMs": 30000
      },
      "Producer": {
        "Acks": "All",
        "Retries": 3,
        "BatchSize": 16384,
        "LingerMs": 100,
        "CompressionType": "Gzip",
        "MaxInFlight": 5,
        "EnableIdempotence": true
      },
      "Consumer": {
        "GroupId": "saga-orchestrator-service-consumer-group",
        "AutoOffsetReset": "Latest",
        "EnableAutoCommit": false,
        "SessionTimeoutMs": 30000,
        "HeartbeatIntervalMs": 3000,
        "MaxPollRecords": 500,
        "MaxPollIntervalMs": 300000
      }
    }
  },
  "AllowedHosts": "*",
  "Flow": {
    "YAML": {
      "Path": "\\AppConfigurations\\Saga\\saga-flow.yaml"
    }
  }
}